# Шифрование сообщений в чате

## Описание
Система чата теперь поддерживает end-to-end шифрование сообщений для обеспечения конфиденциальности переписок пользователей.

## Как это работает

### 1. Генерация ключей
- При первой регистрации пользователя автоматически генерируется пара ключей RSA (публичный и приватный)
- Публичный ключ сохраняется на сервере
- Приватный ключ сохраняется локально в браузере пользователя

### 2. Процесс шифрования
- Каждое сообщение шифруется с помощью AES-256-CBC
- AES ключ шифруется с помощью публичного ключа получателя
- Зашифрованное сообщение и зашифрованный ключ отправляются получателю

### 3. Процесс расшифровки
- Получатель использует свой приватный ключ для расшифровки AES ключа
- Затем AES ключ используется для расшифровки самого сообщения

## Безопасность

### Что защищено:
- ✅ Содержимое сообщений
- ✅ Файлы и голосовые сообщения
- ✅ Метаданные сообщений (кто кому отправляет)

### Что НЕ защищено:
- ❌ Список контактов
- ❌ Время отправки сообщений
- ❌ Статус "прочитано"

## Индикаторы безопасности

В интерфейсе чата отображается индикатор "End-to-End шифрование" с иконкой замка, который показывает, что переписка защищена.

## Технические детали

### Алгоритмы шифрования:
- **RSA-OAEP** (2048 бит) - для шифрования AES ключей
- **AES-256-CBC** - для шифрования содержимого сообщений

### Хранение ключей:
- Публичные ключи: в базе данных сервера
- Приватные ключи: в localStorage браузера

## Устранение неполадок

### Если сообщения не расшифровываются:
1. Проверьте, что у вас есть приватный ключ в localStorage
2. Попробуйте перезагрузить страницу
3. Если проблема остается, обратитесь к администратору

### Если ключи не генерируются:
1. Убедитесь, что браузер поддерживает Web Crypto API
2. Проверьте, что JavaScript включен
3. Попробуйте использовать современный браузер (Chrome, Firefox, Safari, Edge)

## Совместимость

Система шифрования работает в следующих браузерах:
- Chrome 37+
- Firefox 34+
- Safari 11+
- Edge 12+

## Примечания

- Шифрование работает только для новых сообщений
- Старые сообщения остаются незашифрованными
- При смене устройства нужно будет заново сгенерировать ключи 